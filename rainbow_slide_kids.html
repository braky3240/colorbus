<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸŒˆ å½©è™¹æ»‘æ»‘æ¢¯ - å„¿ç«¥ç‰ˆ</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: linear-gradient(180deg, #87CEEB 0%, #FFE5E5 100%);
            font-family: "Comic Sans MS", "Arial Rounded MT Bold", "Segoe UI", sans-serif;
            touch-action: none;
            user-select: none;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        /* é¡¶éƒ¨æ ‡é¢˜ */
        #header {
            position: absolute;
            top: 15px;
            width: 100%;
            text-align: center;
            pointer-events: none;
            z-index: 10;
        }
        
        h1 {
            color: #fff;
            font-size: clamp(24px, 5vw, 36px);
            text-shadow: 3px 3px 0px #FF69B4, 5px 5px 0px rgba(0,0,0,0.2);
            margin: 0;
            font-weight: 900;
            letter-spacing: 3px;
        }
        }

        /* å·¦ä¾§é¢œè‰²é€‰æ‹©åŒº - å§‹ç»ˆæ˜¾ç¤º */
        #color-panel {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 20;
            pointer-events: auto;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 10px;
            border-radius: 25px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .color-label {
            font-size: 20px;
            text-align: center;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .color-option {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            border: 4px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
            position: relative;
        }

        .color-option:hover {
            transform: scale(1.2) rotate(10deg);
        }

        .color-option.selected {
            border-color: #fff;
            box-shadow: 0 0 0 4px rgba(255,215,0,0.8), 0 4px 12px rgba(0,0,0,0.25);
            transform: scale(1.3);
            animation: wiggle 0.5s ease-in-out;
        }

        @keyframes wiggle {
            0%, 100% { transform: scale(1.3) rotate(0deg); }
            25% { transform: scale(1.3) rotate(-10deg); }
            75% { transform: scale(1.3) rotate(10deg); }
        }

        /* å³ä¾§é€Ÿåº¦æ§åˆ¶åŒº - å§‹ç»ˆæ˜¾ç¤º */
        #speed-panel {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 20;
            pointer-events: auto;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 12px;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .speed-label {
            font-size: 18px;
            text-align: center;
            font-weight: bold;
            color: #333;
        }

        .speed-btn {
            width: 55px;
            height: 55px;
            border-radius: 15px;
            border: 3px solid #fff;
            cursor: pointer;
            font-size: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .speed-btn:active {
            transform: translateY(3px);
            box-shadow: 0 1px 0 rgba(0,0,0,0.2);
        }

        .speed-btn.selected {
            box-shadow: 0 0 0 3px rgba(255,215,0,0.8), 0 4px 0 rgba(0,0,0,0.2);
            transform: scale(1.05);
        }

        .speed-slow {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
        }

        .speed-normal {
            background: linear-gradient(135deg, #FFC107, #FFD54F);
        }

        .speed-fast {
            background: linear-gradient(135deg, #FF5722, #FF7043);
        }

        /* åº•éƒ¨å¤§æŒ‰é’® */
        #controls {
            position: absolute;
            bottom: 25px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            pointer-events: none;
            z-index: 10;
            padding: 0 20px;
        }

        .main-btn {
            pointer-events: auto;
            border: none;
            border-radius: 60px;
            padding: 20px 40px;
            font-size: clamp(20px, 4vw, 28px);
            font-weight: 900;
            color: white;
            box-shadow: 0 8px 0 rgba(0,0,0,0.25);
            transition: transform 0.1s, box-shadow 0.1s;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .main-btn:active {
            transform: translateY(6px);
            box-shadow: 0 2px 0 rgba(0,0,0,0.25);
        }

        #spawn-btn {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #d35400;
            border: 5px solid #FFF;
            min-width: 200px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 8px 0 rgba(0,0,0,0.25); }
            50% { box-shadow: 0 8px 0 rgba(0,0,0,0.25), 0 0 30px rgba(255,215,0,0.6); }
        }

        #clear-btn {
            background: linear-gradient(135deg, #FF6B6B, #EE5A6F);
            border: 5px solid #FFF;
            width: 75px;
            height: 75px;
            padding: 0;
            border-radius: 50%;
            font-size: 32px;
        }

        /* åŠ è½½é®ç½© */
        #overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, rgba(255, 107, 129, 0.95), rgba(255, 215, 0, 0.95));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            color: white;
            cursor: pointer;
            gap: 30px;
        }

        #overlay-emoji {
            font-size: clamp(80px, 20vw, 150px);
            animation: bounce 1s ease-in-out infinite;
        }

        #overlay-title {
            font-size: clamp(32px, 8vw, 56px);
            text-shadow: 4px 4px 8px rgba(0,0,0,0.3);
            font-weight: 900;
        }

        #overlay-subtitle {
            font-size: clamp(20px, 5vw, 32px);
            opacity: 0.95;
            animation: blink 1.5s ease-in-out infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 0.95; }
            50% { opacity: 0.5; }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            #color-panel {
                left: 10px;
                padding: 12px 8px;
                gap: 10px;
            }

            .color-option {
                width: 48px;
                height: 48px;
            }

            #speed-panel {
                right: 10px;
                padding: 12px 10px;
                gap: 8px;
            }

            .speed-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }

        @media (max-width: 480px) {
            .color-option {
                width: 42px;
                height: 42px;
            }

            .speed-btn {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }

            #color-panel, #speed-panel {
                top: auto;
                transform: none;
            }

            #color-panel {
                top: 80px;
            }

            #speed-panel {
                top: 80px;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
</head>
<body>

    <div id="overlay">
        <div id="overlay-emoji">ğŸŒˆğŸš—</div>
        <div id="overlay-title">å½©è™¹æ»‘æ»‘æ¢¯</div>
        <div id="overlay-subtitle">ğŸ‘† ç‚¹ä¸€ä¸‹å¼€å§‹ç©ï¼</div>
    </div>

    <div id="game-container">
        <div id="header">
            <h1>ğŸŒˆ å½©è™¹æ»‘æ»‘æ¢¯ ğŸš—</h1>
        </div>

        <!-- å·¦ä¾§é¢œè‰²é€‰æ‹© -->
        <div id="color-panel">
            <div class="color-label">ğŸ¨</div>
            <div id="color-options">
                <!-- ç”±JSç”Ÿæˆ -->
            </div>
        </div>

        <!-- å³ä¾§é€Ÿåº¦é€‰æ‹© -->
        <div id="speed-panel">
            <div class="speed-label">âš¡</div>
            <button class="speed-btn speed-slow" data-speed="2">ğŸŒ</button>
            <button class="speed-btn speed-normal selected" data-speed="5">ğŸš—</button>
            <button class="speed-btn speed-fast" data-speed="8">ğŸš€</button>
        </div>

        <!-- åº•éƒ¨æŒ‰é’® -->
        <div id="controls">
            <button class="main-btn" id="clear-btn">ğŸ—‘ï¸</button>
            <button class="main-btn" id="spawn-btn">ğŸš— å‘å°„!</button>
        </div>
    </div>

<script>
    // ============= æ¸¸æˆé…ç½® =============
    const gameConfig = {
        selectedColor: '#FF4757',
        gravityMultiplier: 5
    };

    const carColors = [
        { color: '#FF4757', emoji: 'â¤ï¸' },
        { color: '#FFA502', emoji: 'ğŸ§¡' },
        { color: '#FFD700', emoji: 'ğŸ’›' },
        { color: '#2ED573', emoji: 'ğŸ’š' },
        { color: '#1E90FF', emoji: 'ğŸ’™' },
        { color: '#3742FA', emoji: 'ğŸ’œ' },
        { color: '#FF6B81', emoji: 'ğŸ’—' },
        { color: '#00CED1', emoji: 'ğŸ©µ' },
        { color: '#FF1493', emoji: 'ğŸ©·' },
        { color: '#FF8C00', emoji: 'ğŸŠ' },
        { color: '#32CD32', emoji: 'ğŸŸ¢' },
        { color: '#8B4513', emoji: 'ğŸ¤' }
    ];

    // ============= éŸ³æ•ˆç³»ç»Ÿ =============
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    let audioCtx;

    function initAudio() {
        if (!audioCtx) {
            audioCtx = new AudioContext();
        }
        if (audioCtx.state === 'suspended') {
            audioCtx.resume();
        }
    }

    // å‘å°„éŸ³æ•ˆ - æ›´æ¬¢å¿«
    function playPopSound() {
        if (!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'sine';
        osc.frequency.setValueAtTime(500, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.15);
        gain.gain.setValueAtTime(0.4, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.15);
    }

    // å®Œæˆå¥–åŠ±éŸ³æ•ˆ - è¶…çº§æ¬¢å¿«
    function playRewardSound() {
        if (!audioCtx) return;
        // ä¸‰ä¸ªéŸ³ç¬¦ä¸Šå‡
        [523.25, 659.25, 783.99, 1046.50].forEach((freq, i) => {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.value = freq;
            
            const startTime = audioCtx.currentTime + (i * 0.08);
            gain.gain.setValueAtTime(0, startTime);
            gain.gain.linearRampToValueAtTime(0.3, startTime + 0.05);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.6);

            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(startTime);
            osc.stop(startTime + 0.7);
        });
    }

    // æŒ‰é’®ç‚¹å‡»éŸ³æ•ˆ
    function playClickSound() {
        if (!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'square';
        osc.frequency.value = 800;
        gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
    }

    // ============= Matter.js ç‰©ç†å¼•æ“ =============
    const Engine = Matter.Engine,
          Render = Matter.Render,
          Runner = Matter.Runner,
          Bodies = Matter.Bodies,
          Composite = Matter.Composite,
          Constraint = Matter.Constraint,
          Mouse = Matter.Mouse,
          MouseConstraint = Matter.MouseConstraint,
          Events = Matter.Events,
          Body = Matter.Body,
          World = Matter.World;

    const engine = Engine.create();
    const world = engine.world;

    engine.positionIterations = 10;
    engine.velocityIterations = 10;

    const width = window.innerWidth;
    const height = window.innerHeight;

    const render = Render.create({
        element: document.getElementById('game-container'),
        engine: engine,
        options: {
            width: width,
            height: height,
            wireframes: false,
            background: 'transparent',
            pixelRatio: Math.min(window.devicePixelRatio, 2)
        }
    });

    // ============= è´å¡å°”æ›²çº¿è½¨é“ =============
    function getBezierPoint(t, p0, p1, p2, p3) {
        const cX = 3 * (p1.x - p0.x),
              bX = 3 * (p2.x - p1.x) - cX,
              aX = p3.x - p0.x - cX - bX;
        const cY = 3 * (p1.y - p0.y),
              bY = 3 * (p2.y - p1.y) - cY,
              aY = p3.y - p0.y - cY - bY;
        const x = (aX * Math.pow(t, 3)) + (bX * Math.pow(t, 2)) + (cX * t) + p0.x;
        const y = (aY * Math.pow(t, 3)) + (bY * Math.pow(t, 2)) + (cY * t) + p0.y;
        return { x: x, y: y };
    }

    function createSmoothTrack() {
        const segments = 50; // æ›´å¹³æ»‘
        const trackThickness = 22;

        const startX = 0;
        const startY = height * 0.22;
        const endX = width + 200; // å»¶ä¼¸åˆ°å±å¹•å¤–
        const endY = height * 0.88; // ç¨å¾®é™ä½ç»ˆç‚¹

        const p0 = { x: startX, y: startY };
        const p1 = { x: width * 0.4, y: startY };
        const p2 = { x: width * 0.3, y: endY };
        const p3 = { x: endX, y: endY + 50 }; // ç»§ç»­å‘ä¸‹å»¶ä¼¸

        let prevPoint = p0;

        for (let i = 1; i <= segments; i++) {
            const t = i / segments;
            const currPoint = getBezierPoint(t, p0, p1, p2, p3);

            const angle = Math.atan2(currPoint.y - prevPoint.y, currPoint.x - prevPoint.x);
            const midX = (prevPoint.x + currPoint.x) / 2;
            const midY = (prevPoint.y + currPoint.y) / 2;
            const length = Math.hypot(currPoint.x - prevPoint.x, currPoint.y - prevPoint.y) + 3;

            const segment = Bodies.rectangle(midX, midY, length, trackThickness, {
                isStatic: true,
                angle: angle,
                friction: 0.05, // è¶…çº§å…‰æ»‘
                render: {
                    fillStyle: `hsl(${i * 7}, 90%, 70%)`, // æ›´é²œè‰³çš„å½©è™¹
                    strokeStyle: 'white',
                    lineWidth: 2
                }
            });
            
            Composite.add(world, segment);
            prevPoint = currPoint;
        }
    }

    createSmoothTrack();

    // ============= å°è½¦ç”Ÿæˆ =============
    function spawnCar() {
        const startX = 120;
        const startY = height * 0.12;
        const chassisWidth = 110;
        const chassisHeight = 40;
        const wheelSize = 20;

        const group = Body.nextGroup(true);
        const color = gameConfig.selectedColor;

        // åœ¨è½¨é“æœ«å°¾ä¸Šæ–¹åˆ›å»ºå¯¹åº”é¢œè‰²çš„ç›®æ ‡åœ†çƒ
        const targetX = width - 100; // è½¨é“æœ«å°¾
        const targetY = height * 0.82; // åœ¨è½¨é“ä¸Šæ–¹
        const targetRadius = 45; // åœ†çƒåŠå¾„
        
        // æ‰¾åˆ°å¯¹åº”é¢œè‰²çš„emoji
        const colorInfo = carColors.find(c => c.color === color);
        const emoji = colorInfo ? colorInfo.emoji : 'ğŸ¯';

        const colorTarget = Bodies.circle(targetX, targetY, targetRadius, {
            isStatic: true,
            isSensor: false, // å¯ä»¥ç¢°æ’
            carColor: color, // æ ‡è®°é¢œè‰²
            isTarget: true, // æ ‡è®°ä¸ºç›®æ ‡å—
            render: {
                fillStyle: color,
                strokeStyle: '#FFF',
                lineWidth: 6
            }
        });

        Composite.add(world, colorTarget);

        // è½¦èº«
        const chassis = Bodies.rectangle(startX, startY, chassisWidth, chassisHeight, {
            collisionFilter: { group: group },
            density: 0.002, 
            friction: 0.5,
            chamfer: { radius: 12 },
            carColor: color, // æ ‡è®°è½¦èº«é¢œè‰²
            targetId: colorTarget.id, // å…³è”ç›®æ ‡å—ID
            render: { 
                fillStyle: color,
                strokeStyle: '#fff',
                lineWidth: 4
            }
        });

        // è½¦è½®
        const wheelOptions = {
            collisionFilter: { group: group },
            friction: 0.9,
            restitution: 0.1,
            density: 0.005,
            render: { fillStyle: '#333', strokeStyle: '#fff', lineWidth: 3 }
        };

        const wheelA = Bodies.circle(startX - 38, startY + 18, wheelSize, wheelOptions);
        const wheelB = Bodies.circle(startX + 38, startY + 18, wheelSize, wheelOptions);

        // æ‚¬æŒ‚
        const axelA = Constraint.create({
            bodyA: chassis, pointA: { x: -38, y: 18 },
            bodyB: wheelA, pointB: { x: 0, y: 0 },
            stiffness: 0.2, damping: 0.08, length: 0, render: { visible: false }
        });

        const axelB = Constraint.create({
            bodyA: chassis, pointA: { x: 38, y: 18 },
            bodyB: wheelB, pointB: { x: 0, y: 0 },
            stiffness: 0.2, damping: 0.08, length: 0, render: { visible: false }
        });

        playPopSound();

        const car = Composite.create({
            bodies: [chassis, wheelA, wheelB],
            constraints: [axelA, axelB],
            label: 'Car'
        });

        // åˆå§‹æ¨åŠ›
        Body.setVelocity(chassis, { x: 6, y: 0 });

        Composite.add(world, car);
    }

    // ============= å½©è‰²çº¸å±‘ - æŒ‡å®šé¢œè‰² =============
    const particles = [];
    function spawnColoredConfetti(x, y, targetColor) {
        playRewardSound();
        for(let i=0; i<80; i++) { // å¢åŠ çº¸å±‘æ•°é‡åˆ°80ä¸ª
            particles.push({
                x: x, y: y,
                vx: (Math.random() - 0.5) * 25, // å¢åŠ æ¨ªå‘æ‰©æ•£é€Ÿåº¦
                vy: (Math.random() - 1.2) * 25, // å¢åŠ çºµå‘æ‰©æ•£é€Ÿåº¦
                life: 2.0, // å»¶é•¿ç”Ÿå‘½å‘¨æœŸ
                color: targetColor, // ä½¿ç”¨æŒ‡å®šçš„é¢œè‰²
                size: Math.random() * 6 + 4, // å¢å¤§çº¸å±‘å°ºå¯¸
                rotation: Math.random() * Math.PI * 2,
                rotationSpeed: (Math.random() - 0.5) * 0.5
            });
        }
    }

    Events.on(render, 'afterRender', function() {
        const ctx = render.context;
        for (let i = particles.length - 1; i >= 0; i--) {
            let p = particles[i];
            p.x += p.vx;
            p.y += p.vy;
            p.vy += 0.4; // é‡åŠ›
            p.rotation += p.rotationSpeed;
            p.life -= 0.012;

            if(p.life <= 0) {
                particles.splice(i, 1);
            } else {
                ctx.save();
                ctx.globalAlpha = p.life;
                ctx.translate(p.x, p.y);
                ctx.rotate(p.rotation);
                ctx.fillStyle = p.color;
                ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size);
                ctx.restore();
            }
        }
        ctx.globalAlpha = 1.0;
    });

    // ============= ç¢°æ’æ£€æµ‹ç³»ç»Ÿ =============
    const explodedTargets = new Set(); // è®°å½•å·²çˆ†ç‚¸çš„ç›®æ ‡å—

    Events.on(engine, 'collisionStart', function(event) {
        const pairs = event.pairs;

        for (let pair of pairs) {
            const bodyA = pair.bodyA;
            const bodyB = pair.bodyB;

            // æ£€æµ‹å°è½¦æ’å‡»ç›®æ ‡å—
            let car = null;
            let target = null;

            if (bodyA.carColor && bodyA.targetId && bodyB.id === bodyA.targetId) {
                car = bodyA;
                target = bodyB;
            } else if (bodyB.carColor && bodyB.targetId && bodyA.id === bodyB.targetId) {
                car = bodyB;
                target = bodyA;
            }

            // å¦‚æœåŒ¹é…åˆ°äº†æ­£ç¡®çš„è½¦å’Œç›®æ ‡å—
            if (car && target && target.isTarget && !explodedTargets.has(target.id)) {
                explodedTargets.add(target.id);
                
                // ç›®æ ‡å—çˆ†ç‚¸æ•ˆæœ
                const x = target.position.x;
                const y = target.position.y;
                
                // æ’­æ”¾éŸ³æ•ˆ
                playRewardSound();
                
                // äº§ç”Ÿå¤§é‡è¯¥é¢œè‰²çš„çº¸å±‘
                spawnColoredConfetti(x, y, car.carColor);
                
                // äº§ç”Ÿå†²å‡»æ³¢æ•ˆæœï¼ˆé¢å¤–çš„ç²’å­ç¯ï¼‰
                spawnShockwave(x, y, car.carColor);
                
                // ç«‹å³ç§»é™¤ç›®æ ‡å—
                World.remove(world, target);
            }
        }
    });

    // å†²å‡»æ³¢ç²’å­æ•ˆæœ
    function spawnShockwave(x, y, color) {
        // åˆ›å»ºä¸€åœˆæ”¾å°„çŠ¶çš„ç²’å­
        for(let i = 0; i < 24; i++) {
            const angle = (i / 24) * Math.PI * 2;
            const speed = 15;
            particles.push({
                x: x,
                y: y,
                vx: Math.cos(angle) * speed,
                vy: Math.sin(angle) * speed,
                life: 1.5,
                color: color,
                size: 8,
                rotation: 0,
                rotationSpeed: 0
            });
        }
    }

    // ============= æ¸¸æˆé€»è¾‘ =============
    function updateGravity() {
        world.gravity.y = gameConfig.gravityMultiplier * 0.2;
    }

    Events.on(engine, 'beforeUpdate', function() {
        updateGravity();
        
        const bodies = Composite.allBodies(world);
        
        for (let body of bodies) {
            // æ¸…ç†å‡ºå±ç‰©ä½“ - ç»™æ›´å¤šç©ºé—´
            if (body.position.y > height + 200 || body.position.x > width + 500) {
                World.remove(world, body);
                continue;
            }
        }
    });

    // ============= UIäº¤äº’ =============
    
    // ç”Ÿæˆé¢œè‰²é€‰æ‹©å™¨
    function initColorPicker() {
        const container = document.getElementById('color-options');
        carColors.forEach((item, index) => {
            const colorBtn = document.createElement('div');
            colorBtn.className = 'color-option';
            colorBtn.style.backgroundColor = item.color;
            colorBtn.title = item.emoji;
            if (index === 0) colorBtn.classList.add('selected');
            
            colorBtn.addEventListener('click', () => {
                playClickSound();
                document.querySelectorAll('.color-option').forEach(el => el.classList.remove('selected'));
                colorBtn.classList.add('selected');
                gameConfig.selectedColor = item.color;
            });
            
            container.appendChild(colorBtn);
        });
    }

    // é€Ÿåº¦æŒ‰é’®
    document.querySelectorAll('.speed-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            playClickSound();
            const speed = parseInt(btn.dataset.speed);
            gameConfig.gravityMultiplier = speed;
            
            document.querySelectorAll('.speed-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        });
    });

    // é¼ æ ‡æ‹–æ‹½
    const mouse = Mouse.create(render.canvas);
    const mouseConstraint = MouseConstraint.create(engine, {
        mouse: mouse,
        constraint: {
            stiffness: 0.1,
            render: { visible: false }
        }
    });
    Composite.add(world, mouseConstraint);
    render.mouse = mouse;

    // æŒ‰é’®äº‹ä»¶
    document.getElementById('spawn-btn').addEventListener('click', (e) => {
        e.stopPropagation();
        spawnCar();
    });

    document.getElementById('clear-btn').addEventListener('click', (e) => {
        e.stopPropagation();
        playClickSound();
        // åˆ·æ–°é¡µé¢ï¼Œé‡æ–°å¼€å§‹
        location.reload();
    });

    // ç§»é™¤å…¨å±€ç‚¹å‡»å‘å°„åŠŸèƒ½ï¼Œåªä¿ç•™æŒ‰é’®å‘å°„

    // å¯åŠ¨é®ç½©
    document.getElementById('overlay').addEventListener('click', function() {
        this.style.display = 'none';
        initAudio();
        initColorPicker();
        setTimeout(spawnCar, 600);
    });

    // è¿è¡Œå¼•æ“
    Render.run(render);
    const runner = Runner.create();
    Runner.run(runner, engine);

    // çª—å£è‡ªé€‚åº”
    window.addEventListener('resize', () => {
        render.canvas.width = window.innerWidth;
        render.canvas.height = window.innerHeight;
    });

</script>
</body>
</html>
